# Claude Code Rules - Generated by Plugin System
# Generated at: Mon Jul 14 10:58:58 JST 2025

**重要: この内容を作業開始前に必ず読んで理解してください**

---

# Claude Code 基本仕組みプラグイン

このプラグインは、Claude Codeの基本的な仕組みと制約を説明します。

## Claude Codeの基本仕組み

### 実行環境
- **Shell環境**: 基本的にfishを使用
- **なんでもできる**: fishで実行可能なコマンドは基本的に全て利用可能
- **mise優先**: アプリケーションインストールはmise経由を推奨

### 制約事項

#### ❌ できないこと
```bash
# sudo権限が必要な操作
sudo apt install package  # → ユーザーに依頼
sudo systemctl restart service  # → ユーザーに依頼
sudo chmod +x /usr/bin/script  # → ユーザーに依頼
```

#### ✅ できること（fish経由）
```bash
# 通常のコマンド実行
fish -c "ls -la"
fish -c "grep pattern file.txt"
fish -c "git status"

# mise経由のツール管理
fish -c "mise install python@3.12"
fish -c "mise use python@3.12"
fish -c "mise list"

# ファイル操作
fish -c "touch newfile.txt"
fish -c "mkdir new_directory"
fish -c "cp source.txt dest.txt"
```

## アプリケーションインストール戦略

### 1. mise優先でインストール
```bash
# Python
fish -c "mise install python@3.12"

# Node.js
fish -c "mise install node@20"

# Rust
fish -c "mise install rust@latest"

# その他開発ツール
fish -c "mise install neovim@stable"
fish -c "mise install ripgrep@latest"
```

### 2. miseで対応できない場合
```
ユーザーに以下を依頼：
「以下のパッケージをインストールしてください：
sudo apt install [package-name]」
```

### 3. 確認方法
```bash
# インストール済みツールの確認
fish -c "mise list"
fish -c "which python"
fish -c "python --version"
```

## .claudeフォルダの構成

### ディレクトリ構造
```
~/.claude/
├── .credentials.json          # 認証情報
├── settings.local.json        # ローカル設定・権限管理
├── projects/                  # プロジェクト別データ
│   ├── -home-motoki--config-nvim/    # プロジェクト名（パス変換）
│   │   ├── session-uuid.jsonl       # 会話ログ（詳細）
│   │   └── compressed-uuid.jsonl    # 圧縮後ログ（summary）
│   └── other-projects/
├── todos/                     # Todo管理
│   └── session-uuid.json      # セッション別Todo
├── shell-snapshots/           # Shell状態スナップショット
└── statsig/                   # 統計・機能フラグ
    └── statsig.cached.evaluations.*
```

### 重要ファイル

#### settings.local.json
```json
{
  "permissions": {
    "allow": [
      "WebFetch(domain:github.com)"
    ],
    "deny": []
  }
}
```

#### プロジェクト別ログ（.jsonl）
- **詳細ログ**: 全ての会話・ツール使用を記録
- **自動コンパクション**: 一定時間後にsummaryに圧縮
- **永続性**: 重要な情報はloggingプラグインで別途保存

## fishシェルの活用

### 基本方針
```bash
# 常にfish経由でコマンド実行
fish -c "command"

# mise環境の自動適用
fish -c "mise exec -- command"

# 複数コマンドの連鎖実行
fish -c "command1 && command2 || echo 'failed'"
```

### 環境変数とPATH
```bash
# mise管理ツールの確認
fish -c "echo $PATH | tr ':' '\n' | grep mise"

# 現在の環境確認
fish -c "env | grep -E '(MISE|PATH)'"
```

## 権限管理システム

### 自動実行許可の仕組み
1. **初回実行**: ユーザーに許可を求める
2. **継続実行**: 同じコマンドは自動実行
3. **セッション別**: セッションが変わると権限リセット
4. **コマンド別**: 新しいコマンドは都度許可が必要

### 効率的な権限設定
```bash
# 基本コマンド群を事前実行して許可取得
fish -c "ls -la && pwd && git status && mise list"
```

## トラブルシューティング

### よくある問題

#### 1. miseツールが認識されない
```bash
# 解決方法
fish -c "mise doctor"
fish -c "mise reshim"
```

#### 2. 権限エラー
```
sudo権限が必要 → ユーザーに依頼
「以下をターミナルで実行してください：
sudo [command]」
```

#### 3. PATH問題
```bash
# PATH確認
fish -c "echo $PATH"
fish -c "which command"
```

## ベストプラクティス

### 1. 環境確認から開始
```bash
fish -c "pwd && git status && mise list"
```

### 2. ツールの存在確認
```bash
fish -c "which python || echo 'Python not found'"
fish -c "mise list | grep python || echo 'Python not in mise'"
```

### 3. エラー時の対処
```bash
# コマンドが見つからない場合
fish -c "mise install tool@version"

# 権限エラーの場合
# → ユーザーに sudo 実行を依頼
```

---

このプラグインにより、Claude Codeの仕組みを理解し、
制約を回避しながら効率的に作業できます。

**重要**: sudo権限が必要な操作は必ずユーザーに依頼してください。
---

# Claude Code 自動実行設定プラグイン

このプラグインは、Claude Codeの自動実行機能を効率的に設定するためのガイドです。

## 自動実行の基本理念

**「有効な時はどんどん行っちゃう仕様」**
- 一度許可したコマンドカテゴリは継続的に自動実行
- ファイル編集と安全なコマンド実行を積極的に自動化
- fish shell環境を最大限活用

## 推奨自動実行設定手順

### 1. 初回セットアップ（この順番で実行）

```bash
# 基本コマンド群の自動実行許可
fish -c "ls -la"          # ファイル一覧表示
fish -c "pwd"             # 現在ディレクトリ確認
fish -c "git status"      # Git状態確認
fish -c "cat /etc/os-release" # OS情報確認

# ファイル編集関連の自動実行許可
# Edit, Write, Read ツールの自動実行を許可
# ※これらはClaude側のツールなので、最初の使用時に自動実行許可が求められる

# 開発関連コマンドの自動実行許可
fish -c "mise list"       # 開発ツール一覧
fish -c "python --version" # Python確認
fish -c "node --version"  # Node確認
fish -c "cargo --version" # Rust確認
fish -c "nvim --version"  # Neovim確認
```

### 2. プロジェクト別自動実行設定

```bash
# プロジェクト固有のコマンドも事前実行して許可取得
fish -c "npm list"        # Node.jsプロジェクトの場合
fish -c "cargo check"     # Rustプロジェクトの場合
fish -c "pytest --version" # Pythonプロジェクトの場合
```

## Fish Shell ハック活用

### 複数コマンド一括実行
```bash
fish -c "ls -la && git status && mise list"
```

### 条件付き実行
```bash
fish -c "test -f package.json && npm list || echo 'Not a Node project'"
```

### パイプライン処理
```bash
fish -c "find . -name '*.rs' | head -5"
```

## 自動実行対象コマンドカテゴリ

### ✅ 積極的に自動実行すべき
- **ファイル操作**: `ls`, `find`, `grep`, `cat`, `head`, `tail`
- **Git操作**: `git status`, `git diff`, `git log`, `git branch`
- **開発ツール**: `mise list`, `python`, `node`, `cargo`, `nvim`
- **システム情報**: `pwd`, `whoami`, `uname`, `df -h`
- **プロジェクト確認**: `package.json`, `Cargo.toml`, `requirements.txt`の読み取り

### ⚠️ 慎重に自動実行
- **ファイル作成**: `touch`, `mkdir`（テスト目的のみ）
- **ビルド系**: `npm install`, `cargo build`（時間がかかる）
- **テスト実行**: `pytest`, `cargo test`（結果を確認したい）

### ❌ 自動実行しない
- **削除操作**: `rm`, `rmdir`
- **システム変更**: `sudo`系コマンド
- **ネットワーク**: `curl`, `wget`（WebSearchツール使用）

## Claude Code利用のベストプラクティス

### 1. セッション開始時のルーチン
```
1. "このプロジェクトの構造を把握して"
2. 自動実行が働くのを確認
3. "mise環境でPython/Node/Rustを使って作業して"
```

### 2. 効率的な指示の出し方
- **具体的**: "xxxファイルを編集して機能追加"
- **一括指示**: "テスト実行して、エラーがあれば修正して"
- **環境指定**: "fish環境でmise管理のツールを使って"

### 3. トラブル時の対処
- 自動実行が止まったら: `fish -c "適当なコマンド"` で再許可
- 長いコマンドがエラー: fishハックで回避
- mise環境が使われない: 明示的に`fish -c`を依頼

## プロジェクト固有の設定例

### Neovim設定プロジェクト
```bash
fish -c "nvim --version && find . -name '*.lua' | head -5"
```

### Rust開発プロジェクト
```bash
fish -c "cargo --version && ls src/ && cargo check"
```

### Web開発プロジェクト
```bash
fish -c "node --version && npm list && ls public/"
```

## 注意事項

- **セッション毎にリセット**: Claude Codeの自動実行許可はセッション毎
- **コマンド別管理**: 新しいコマンドは初回実行時に許可が必要
- **fish環境の活用**: mise管理のツールを使うためfishハック必須
- **安全第一**: 破壊的操作は手動確認を維持

---

このプラグインにより、Claude Codeの自動実行機能を最大限活用し、
fish + mise環境でのスムーズな開発体験を実現できます。
---

# Claude Code Git管理プラグイン

このプラグインは、Claude CodeでのGit管理における基本ルールを定義します。

## 基本ルール

### ブランチ戦略
```bash
# 作業開始時
fish -c "git checkout -b claude-coding"

# 作業終了時（ユーザー指示で）
fish -c "git checkout main && git merge claude-coding && git branch -d claude-coding"
```

### コミット方針
**必要なファイルのみ個別にコミット**
```bash
# ❌ 全ファイル一括コミット（禁止）
git add -A
git add .

# ✅ 必要なファイルのみ（推奨）
fish -c "git add specific_file.py"
fish -c "git add src/module.rs"
fish -c "git add config/settings.toml"
```

### タイミング管理
- **コミットタイミング**: ユーザーの指示を待つ
- **マージタイミング**: ユーザーの指示を待つ
- **自動実行範囲**: 状態確認コマンドのみ

## 自動実行許可コマンド

### ✅ 積極的に自動実行
```bash
fish -c "git status"
fish -c "git branch"
fish -c "git log --oneline -5"
fish -c "git diff --stat"
fish -c "git checkout claude-coding"
```

### ❌ ユーザー指示が必要
- `git add`
- `git commit`
- `git merge` 
- `git push`
- `git pull`

## 作業フロー

1. **ブランチ作成**: `claude-coding`ブランチで作業
2. **ファイル編集**: 必要な変更を実施
3. **状態確認**: `git status`で変更確認
4. **コミット待機**: ユーザーの指示を待つ
5. **マージ待機**: ユーザーの指示を待つ
6. **ブランチ削除**: マージ後にclaude-codingブランチ削除

---

シンプルで安全なGit管理を実現します。
---

# Claude Code ロギングプラグイン - 消失対策版

このプラグインは、Claude Codeの自動コンパクションで失われる重要な情報を保護するためのガイドです。

## 基本方針

**「消えるファイル対策」**
- Claude Codeの`.jsonl`は自動コンパクションで消える
- 重要な情報のみ永続保存
- タイミングはユーザー主導

## 保存対象と優先度

### 🔴 最優先（必ず保存）
- **重大なエラーとその解決法**
- **システム設定変更の記録**
- **成功した複雑なコマンド手順**
- **発見したバグとワークアラウンド**

### 🟡 重要（定期的に保存）
- **プロジェクトの重要な進捗**
- **有用なfishハック手順**
- **mise環境の設定変更**
- **効果的だった自動実行パターン**

### 🟢 参考（必要に応じて保存）
- **一般的な作業ログ**
- **テストコマンドの結果**
- **実験的な試行錯誤**

## 永続保存の仕組み

### 保存先ディレクトリ
```
~/.claude_persistent_logs/
├── important/              # 重要ログ
│   ├── errors.md          # エラー・解決法
│   ├── system_changes.md  # システム変更
│   └── discoveries.md     # 発見・ノウハウ
├── project/               # プロジェクト別
│   ├── nvim_config.md     # Neovim設定関連
│   ├── rust_dev.md        # Rust開発関連
│   └── web_dev.md         # Web開発関連
└── archive/               # アーカイブ
    ├── 2025-07/           # 月別アーカイブ
    └── sessions/          # セッション別
```

### 保存コマンド（ユーザー実行）

```bash
# 重大エラーの記録
fish -c "echo '## $(date): [エラー内容]' >> ~/.claude_persistent_logs/important/errors.md"
fish -c "echo '解決法: [手順]' >> ~/.claude_persistent_logs/important/errors.md"
fish -c "echo '' >> ~/.claude_persistent_logs/important/errors.md"

# システム変更の記録
fish -c "echo '## $(date): [変更内容]' >> ~/.claude_persistent_logs/important/system_changes.md"
fish -c "echo '詳細: [具体的な変更]' >> ~/.claude_persistent_logs/important/system_changes.md"
fish -c "echo '' >> ~/.claude_persistent_logs/important/system_changes.md"

# 発見・ノウハウの記録
fish -c "echo '## $(date): [発見内容]' >> ~/.claude_persistent_logs/important/discoveries.md"
fish -c "echo 'コマンド: [具体的なコマンド]' >> ~/.claude_persistent_logs/important/discoveries.md"
fish -c "echo '' >> ~/.claude_persistent_logs/important/discoveries.md"
```

## Fish Shell ハック活用

### 複数コマンド一括実行
```bash
fish -c "ls -la && git status && mise list"
```

### 条件付き実行
```bash
fish -c "test -f package.json && npm list || echo 'Not a Node project'"
```

### パイプライン処理
```bash
fish -c "find . -name '*.rs' | head -5"
```

## 自動実行対象コマンドカテゴリ

### ✅ 積極的に自動実行すべき
- **ファイル操作**: `ls`, `find`, `grep`, `cat`, `head`, `tail`
- **Git操作**: `git status`, `git diff`, `git log`, `git branch`
- **開発ツール**: `mise list`, `python`, `node`, `cargo`, `nvim`
- **システム情報**: `pwd`, `whoami`, `uname`, `df -h`
- **プロジェクト確認**: `package.json`, `Cargo.toml`, `requirements.txt`の読み取り

### ⚠️ 慎重に自動実行
- **ファイル作成**: `touch`, `mkdir`（テスト目的のみ）
- **ビルド系**: `npm install`, `cargo build`（時間がかかる）
- **テスト実行**: `pytest`, `cargo test`（結果を確認したい）

### ❌ 自動実行しない
- **削除操作**: `rm`, `rmdir`
- **システム変更**: `sudo`系コマンド
- **ネットワーク**: `curl`, `wget`（WebSearchツール使用）

## Claude Code利用のベストプラクティス

### 1. セッション開始時のルーチン
```
1. "このプロジェクトの構造を把握して"
2. 自動実行が働くのを確認
3. "mise環境でPython/Node/Rustを使って作業して"
```

### 2. 効率的な指示の出し方
- **具体的**: "xxxファイルを編集して機能追加"
- **一括指示**: "テスト実行して、エラーがあれば修正して"
- **環境指定**: "fish環境でmise管理のツールを使って"

### 3. トラブル時の対処
- 自動実行が止まったら: `fish -c "適当なコマンド"` で再許可
- 長いコマンドがエラー: fishハックで回避
- mise環境が使われない: 明示的に`fish -c`を依頼

## プロジェクト固有の設定例

### Neovim設定プロジェクト
```bash
fish -c "nvim --version && find . -name '*.lua' | head -5"
```

### Rust開発プロジェクト
```bash
fish -c "cargo --version && ls src/ && cargo check"
```

### Web開発プロジェクト
```bash
fish -c "node --version && npm list && ls public/"
```

## 注意事項

- **セッション毎にリセット**: Claude Codeの自動実行許可はセッション毎
- **コマンド別管理**: 新しいコマンドは初回実行時に許可が必要
- **fish環境の活用**: mise管理のツールを使うためfishハック必須
- **安全第一**: 破壊的操作は手動確認を維持

---

このプラグインにより、Claude Codeの自動実行機能を最大限活用し、
fish + mise環境でのスムーズな開発体験を実現できます。

---

# プロジェクト固有の追加ルール

（必要に応じてここにプロジェクト固有のルールを追加）
