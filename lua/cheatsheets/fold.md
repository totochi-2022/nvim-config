# フォールド（折りたたみ）操作

## 基本操作

### フォールドの開閉
| キー | 動作 | 説明 |
|------|------|------|
| `za` | トグル | カーソル位置のフォールドを開閉 |
| `zo` | 開く | カーソル位置のフォールドを開く |
| `zc` | 閉じる | カーソル位置のフォールドを閉じる |
| `zO` | 全開 | カーソル位置のフォールドを再帰的に開く |
| `zC` | 全閉 | カーソル位置のフォールドを再帰的に閉じる |

### 全体操作
| キー | 動作 | 説明 |
|------|------|------|
| `zR` | 全て開く | ファイル内の全フォールドを開く |
| `zM` | 全て閉じる | ファイル内の全フォールドを閉じる |
| `zr` | レベル開く | foldlevelを1増やす |
| `zm` | レベル閉じる | foldlevelを1減らす |
| `zx` | 更新 | フォールドを更新 |
| `zX` | 元に戻す | 全て閉じてカーソル行を開く |

### フォールド間の移動
| キー | 動作 | 説明 |
|------|------|------|
| `zj` | 次のフォールドへ | 下方向の次のフォールド開始位置 |
| `zk` | 前のフォールドへ | 上方向の前のフォールド開始位置 |
| `[z` | フォールド開始へ | 現在のフォールドの開始位置 |
| `]z` | フォールド終了へ | 現在のフォールドの終了位置 |

## フォールド作成・削除

### 手動フォールド
| キー | 動作 | 説明 |
|------|------|------|
| `zf{motion}` | 作成 | モーション範囲でフォールド作成 |
| `{Visual}zf` | 選択範囲で作成 | ビジュアル選択範囲をフォールド |
| `zd` | 削除 | カーソル位置のフォールドを削除 |
| `zD` | 再帰削除 | カーソル位置のフォールドを再帰的に削除 |
| `zE` | 全削除 | ファイル内の全フォールドを削除 |

## フォールド設定

### フォールドメソッド
| 設定 | 説明 | 使用場面 |
|------|------|----------|
| `manual` | 手動作成 | zfで明示的に作成 |
| `indent` | インデント基準 | Python等に最適 |
| `expr` | 式で判定 | カスタムロジック |
| `marker` | マーカー基準 | {{{と}}}を使用 |
| `syntax` | 構文基準 | 言語の構文に従う |
| `diff` | 差分表示用 | vimdiffで使用 |

### 現在の設定確認
```vim
:set foldmethod?    " 現在のフォールドメソッド
:set foldlevel?     " 現在のフォールドレベル
:set foldcolumn?    " フォールド列の幅
```

## TreeSitter フォールド（nvim-treesitter）

Neovimでは`nvim-treesitter`による賢いフォールドが可能：

```vim
:set foldmethod=expr
:set foldexpr=nvim_treesitter#foldexpr()
```

## カスタムキーマップ（Foldモード）

`za`キーを押すとFoldモードに入り、以下のキーが使用可能：

### フォールドレベル設定
| キー | 動作 | 説明 |
|------|------|------|
| `0` | レベル0に設定 | 全て折りたたむ |
| `1` | レベル1に設定 | 第1レベルまで開く |
| `2` | レベル2に設定 | 第2レベルまで開く |
| `3` | レベル3に設定 | 第3レベルまで開く |
| `4` | レベル4に設定 | 第4レベルまで開く |

※ `SetFoldLevel()`関数を使用（`03_function.lua`で定義）

## フォールドテキスト表示（foldCC.vim）

**foldCC.vim**プラグインによるカスタム表示：
- 折りたたみマーカー（`---`）
- 行数表示（例: `(42 lines)`）
- フォールド内容のプレビュー

## 現在の設定

### フォールド設定（`02_option.lua`）
- **メソッド**: TreeSitter式ベース（`nvim_treesitter#foldexpr()`）
- **起動時**: フォールド無効（`foldenable = false`）
- **初期レベル**: 99（深いレベルまで開く）
- **自動展開**: カーソル移動以外で自動的に開く

---
💡 **Tips**: 
- `za`でFoldモードに入り、`0-4`でレベル調整が素早くできる
- TreeSitterベースなので言語構造を正確に認識
- foldCC.vimで見やすい折りたたみ表示