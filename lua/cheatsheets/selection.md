# 選択・ビジュアルモード操作

## ビジュアルモードの種類

### モード切り替え
| キー | 動作 | 説明 |
|------|------|------|
| `v` | 文字選択モード | 文字単位で選択 |
| `V` | 行選択モード | 行単位で選択 |
| `<C-v>` | 矩形選択モード | ブロック（矩形）選択 |
| `gv` | 前回の選択を再選択 | 最後の選択範囲を復元 |
| `v` → `v` | モード切替 | カスタム：選択モード切替 |

## 選択範囲の拡張・縮小

### 基本的な拡張
| キー | 動作 | 説明 |
|------|------|------|
| `o` | 選択の反対側へ | 選択範囲の開始/終了点を切替 |
| `O` | 矩形選択で反対側へ | ブロック選択の対角へ |
| `<S-Up/Down/Left/Right>` | 方向拡張 | Shiftキーで選択拡張 |

### テキストオブジェクトで選択

#### 標準テキストオブジェクト
| キー | 動作 | 説明 |
|------|------|------|
| `viw` | 単語内を選択 | inner word |
| `vaw` | 単語全体を選択 | a word（空白含む） |
| `vi"` | ""内を選択 | inner quotes |
| `va"` | ""全体を選択 | a quotes |
| `vi(` `vi)` | ()内を選択 | inner parentheses |
| `va(` `va)` | ()全体を選択 | a parentheses |
| `vi{` `vi}` | {}内を選択 | inner braces |
| `va{` `va}` | {}全体を選択 | a braces |
| `vit` | タグ内を選択 | inner tag（HTML/XML） |
| `vat` | タグ全体を選択 | a tag |
| `vip` | 段落内を選択 | inner paragraph |
| `vap` | 段落全体を選択 | a paragraph |

#### プラグイン拡張テキストオブジェクト
| キー | 動作 | プラグイン |
|------|------|------------|
| `vil` | 行内を選択 | vim-textobj-line |
| `val` | 行全体を選択 | vim-textobj-line |
| `vie` | バッファ全体内を選択 | vim-textobj-entire |
| `vae` | バッファ全体を選択 | vim-textobj-entire |
| `vib` | 任意の括弧内を選択 | vim-textobj-anyblock |
| `vab` | 任意の括弧全体を選択 | vim-textobj-anyblock |
| `viB` | 複数括弧内を選択 | vim-textobj-multiblock |
| `vaB` | 複数括弧全体を選択 | vim-textobj-multiblock |
| `vi,` | パラメータ内を選択 | vim-textobj-parameter |
| `va,` | パラメータ全体を選択 | vim-textobj-parameter |
| `vic` | コメント内を選択 | vim-textobj-comment |
| `vac` | コメント全体を選択 | vim-textobj-comment |

#### TreeSitterテキストオブジェクト（nvim-treesitter-textobjects）
| キー | 動作 | 説明 |
|------|------|------|
| `vif` | 関数内を選択 | inner function |
| `vaf` | 関数全体を選択 | a function |
| `vic` | クラス内を選択 | inner class |
| `vac` | クラス全体を選択 | a class |
| `vii` | if文内を選択 | inner if |
| `vai` | if文全体を選択 | a if |
| `vil` | ループ内を選択 | inner loop |
| `val` | ループ全体を選択 | a loop |

### スマート選択（プラグイン）
| キー | 動作 | 説明 |
|------|------|------|
| `<LocalLeader>j` | 選択拡張＋モード開始 | expand_regionモード開始 |
| `<LocalLeader>s` | TreeSitter選択 | TreeSitterノード選択 |

#### expand_regionモード内操作
| キー | 動作 | 説明 |
|------|------|------|
| `j` | 選択範囲を広げる | 賢く外側へ拡張 |
| `J`/`k` | 選択範囲を狭める | 内側へ縮小 |

#### TreeSitter選択（その他）
| キー | 動作 | 説明 |
|------|------|------|
| `n<LocalLeader>s` | ノーマルから選択 | v + TreeSitter選択 |
| `o<LocalLeader>s` | 操作待機で選択 | オペレータ待機モード |
| `x<LocalLeader>s` | ビジュアルで選択 | 選択範囲でTreeSitter |
| `oiu` | TS:ユニット内選択 | TreeSitterユニット内 |
| `oau` | TS:ユニット全体選択 | TreeSitterユニット全体 |

## 選択範囲の操作

### 移動・編集
| キー | 動作 | 説明 |
|------|------|------|
| `<C-Up>` | 選択行を上へ | 選択範囲を上に移動 |
| `<C-Down>` | 選択行を下へ | 選択範囲を下に移動 |
| `>` | インデント増加 | 選択範囲を右にインデント |
| `<` | インデント減少 | 選択範囲を左にインデント |
| `=` | インデント整形 | 選択範囲を自動整形 |
| `gq` | 整形 | 選択範囲をフォーマット |

### 数値操作（dial.nvim）
| キー | 動作 | 説明 |
|------|------|------|
| `+` | インクリメント | 選択範囲の数値を増加 |
| `-` | デクリメント | 選択範囲の数値を減少 |
| `g+` | 累積インクリメント | 連番作成（1,2,3...） |
| `g-` | 累積デクリメント | 逆連番作成 |

### テキスト操作
| キー | 動作 | 説明 |
|------|------|------|
| `y` | ヤンク | 選択範囲をコピー |
| `d` | 削除 | 選択範囲を削除 |
| `c` | 変更 | 選択範囲を削除して挿入モード |
| `p` | ペースト | 選択範囲を置換 |
| `u` | 小文字化 | 選択範囲を小文字に |
| `U` | 大文字化 | 選択範囲を大文字に |
| `~` | 大小文字反転 | 大文字⇔小文字切替 |

## カスタム機能

### 翻訳・変換
| キー | 動作 | 説明 |
|------|------|------|
| `<LocalLeader>t` | 翻訳 | 選択テキストを翻訳 |
| `ml` | CR削除 | 選択範囲の改行コード削除 |

### ハイライト
| キー | 動作 | 説明 |
|------|------|------|
| `<LocalLeader>x` | ハイライト追加 | 選択範囲をハイライト |
| `<LocalLeader>X` | ハイライトリセット | ハイライトを全削除 |

### 外部連携
| キー | 動作 | 説明 |
|------|------|------|
| `mA` | ブラウザ検索 | 選択テキストをWeb検索 |
| `ma` | URL開く | 選択URLをブラウザで開く |

### コマンド実行
| キー | 動作 | 説明 |
|------|------|------|
| `;` | 選択範囲コマンド | 選択範囲に対するコマンド入力 |
| `:` | コマンドライン | 通常のコマンドライン |

## 検索・置換での選択

| キー | 動作 | 説明 |
|------|------|------|
| `<Leader>r` | 現在バッファ検索 | 選択単語を現在バッファで検索 |
| `*` | 前方検索 | 選択テキストで検索（プラグイン） |
| `#` | 後方検索 | 選択テキストで逆検索（プラグイン） |

## 括弧・囲み文字操作

### nvim-surround（プラグイン）

#### 通常モード
| キー | 動作 | 説明 |
|------|------|------|
| `ys{motion}{char}` | 囲む | モーション範囲を文字で囲む |
| `ysiw"` | 単語を""で囲む | 例: word → "word" |
| `ysiw(` | 単語を()で囲む（スペース付） | 例: word → ( word ) |
| `ysiw)` | 単語を()で囲む（スペースなし） | 例: word → (word) |
| `ysiwt<tag>` | HTMLタグで囲む | 例: word → `<tag>word</tag>` |
| `yss"` | 行全体を""で囲む | 現在行を囲む |
| `ds{char}` | 囲み削除 | 指定文字の囲みを削除 |
| `ds"` | ""を削除 | "word" → word |
| `dst` | タグを削除 | `<tag>word</tag>` → word |
| `cs{old}{new}` | 囲み変更 | 囲み文字を変更 |
| `cs"'` | ""を''に変更 | "word" → 'word' |
| `cs)]` | ()を[]に変更 | (word) → [word] |

#### ビジュアルモード
| キー | 動作 | 説明 |
|------|------|------|
| `S{char}` | 選択範囲を囲む | 選択テキストを文字で囲む |
| `S"` | 選択を""で囲む | 選択 → "選択" |
| `S<tag>` | タグで囲む | 選択 → `<tag>選択</tag>` |

### 自動ペア入力（nvim-autopairs）
| 入力 | 結果 | 説明 |
|------|------|------|
| `(` | `(|)` | 自動的に閉じ括弧を追加 |
| `[` | `[|]` | 自動的に閉じ括弧を追加 |
| `{` | `{|}` | 自動的に閉じ括弧を追加 |
| `"` | `"|"` | 自動的に閉じ引用符を追加 |
| `'` | `'|'` | 自動的に閉じ引用符を追加 |
| `` ` `` | `` `|` `` | バッククォート自動閉じ |
| `)` → `)`時 | スキップ | 既存の閉じ括弧をスキップ |

### よく使う囲み操作の例
| 操作 | キー | 変換例 |
|------|------|--------|
| 単語を関数呼び出しに | `ysiw)ifunc<Esc>` | word → func(word) |
| 選択範囲をコメントに | `S*gvS*` | 選択 → `/* 選択 */` |
| クォート種類変更 | `cs'"` | 'text' → "text" |
| 括弧種類変更 | `cs{[` | {item} → [item] |
| タグ追加 | `ysiw<em>` | word → `<em>word</em>` |
| タグ変更 | `cst<strong>` | `<em>word</em>` → `<strong>word</strong>` |

## Tips & トリック

### 効率的な選択方法
1. **単語選択**: `viw` → 必要に応じて `vaw`
2. **関数選択**: `vaf`（関数全体）、`vif`（関数内部）
3. **ブロック選択**: `<C-v>` で矩形選択 → 複数行同時編集

### よく使うコンボ
| 操作 | キー | 説明 |
|------|------|------|
| 単語置換 | `viwp` | 単語を選択してペースト |
| 行複製 | `Vyp` | 行選択→ヤンク→ペースト |
| インデント調整 | `vip=` | 段落全体を自動整形 |
| 括弧内変更 | `ci(` | ()内を削除して編集 |

---
💡 **Tips**: 
- テキストオブジェクト（`i`/`a`）を活用すると効率的
- ビジュアルモードでの`.`（ドット）で前回操作を繰り返し可能
- `gv`で前回選択を再現できるのは意外と便利